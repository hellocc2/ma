{-include file="header.htm"-}
{-include file="reference.htm"-}
<body>
	<input id="frame_url" type="hidden" value="{-$smarty.server.REQUEST_URI-}"/>
	<link href="image/w_stronglist.css" rel="stylesheet" type="text/css" />
	<script src="javascript/htcommon.js" type="text/javascript"></script>
	<style type="text/css">
		.catebutton {
			-moz-box-shadow: inset 50px 50px 50px 50px #ffffff;
			-webkit-box-shadow: inset 50px 50px 50px 50px #ffffff;
			box-shadow: inset 50px 50px 50px 50px #ffffff;
			background-color: #f9f9f9;
			-webkit-border-top-left-radius: 9px;
			-moz-border-radius-topleft: 9px;
			border-top-left-radius: 9px;
			-webkit-border-top-right-radius: 9px;
			-moz-border-radius-topright: 9px;
			border-top-right-radius: 9px;
			-webkit-border-bottom-right-radius: 9px;
			-moz-border-radius-bottomright: 9px;
			border-bottom-right-radius: 9px;
			-webkit-border-bottom-left-radius: 9px;
			-moz-border-radius-bottomleft: 9px;
			border-bottom-left-radius: 9px;
			text-indent: 0;
			border: 1px solid #dcdcdc;
			display: inline-block;
			color: #666666;
			font-family: Arial;
			font-size: 8px;
			font-weight: bold;
			font-style: normal;
			height: 22px;
			line-height: 22px;
			width: 68px;
			text-decoration: none;
			text-align: center;
			text-shadow: 1px 1px 0px #ffffff;
		}
		.catebutton:hover {
			background-color: #e9e9e9;
		}
		.catebutton:active {
			position: relative;
			top: 1px;
		}
	</style>
	<style type="text/css">
		ul, ol, li {
			margin: auto;
			padding: 0 15px;
			list-style-position: inside;
		}
	</style>

	<style>
		.PromotionName {
			display: inline-block;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			width: 340px;
		}
		.custom-name {
			position: relative;
			display: inline-block;
		}
		.custom-name-toggle {
			position: absolute;
			top: 0;
			bottom: 0;
			margin-left: -1px;
			padding: 0;
			/* support: IE7 */
			*height: 1.7em;
			*top: 0.1em;
		}
		.custom-name-input {
			margin: 0;
			padding: 0.3em;
			width: 300px;
		}

		.ui-autocomplete {
			max-height: 200px;
			overflow-y: auto;
		}
	</style>
	<script>
		(function($) {
			$.widget("custom.name", {
				_create : function() {
					this.wrapper = $("<span>").addClass("custom-name").insertAfter(this.element);

					this.element.hide();
					this._createAutocomplete();
					this._createShowAllButton();
				},

				_createAutocomplete : function() {
					var selected = this.element.children(":selected"), value = selected.val() ? selected.text() : "";

					this.input = $("<input>").appendTo(this.wrapper).val(value).attr("title", "").addClass("custom-name-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({
						delay : 0,
						minLength : 0,
						source : $.proxy(this, "_source")
					}).tooltip({
						tooltipClass : "ui-state-highlight"
					});

					this._on(this.input, {
						autocompleteselect : function(event, ui) {
							ui.item.option.selected = true;
							this._trigger("select", event, {
								item : ui.item.option
							});
						},

						autocompletechange : "_removeIfInvalid"
					});
				},

				_createShowAllButton : function() {
					var input = this.input, wasOpen = false;

					$("<a>").attr("tabIndex", -1).attr("title", "显示全部选项").tooltip().appendTo(this.wrapper).button({
						icons : {
							primary : "ui-icon-triangle-1-s"
						},
						text : false
					}).removeClass("ui-corner-all").addClass("custom-name-toggle ui-corner-right").mousedown(function() {
						wasOpen = input.autocomplete("widget").is(":visible");
					}).click(function() {
						input.focus();

						// Close if already visible
						if (wasOpen) {
							return;
						}

						// Pass empty string as value to search for, displaying all results
						input.autocomplete("search", "");
					});
				},

				_source : function(request, response) {
					var matcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), "i");
					response(this.element.children("option").map(function() {
						var text = $(this).text();
						if (this.value && (!request.term || matcher.test(text) ))
							return {
								label : text,
								value : text,
								option : this
							};
					}));
				},

				_removeIfInvalid : function(event, ui) {

					// Selected an item, nothing to do
					if (ui.item) {
						return;
					}

					// Search for a match (case-insensitive)
					var value = this.input.val(), valueLowerCase = value.toLowerCase(), valid = false;
					this.element.children("option").each(function() {
						if ($(this).text().toLowerCase() === valueLowerCase) {
							this.selected = valid = true;
							return false;
						}
					});

					// Found a match, nothing to do
					if (valid) {
						return;
					}

					// Remove invalid value
					this.input.val("").attr("title", value + " 没有找到匹配的选项默认上次的结果").tooltip("open");
					this.element.val("");
					this._delay(function() {
						this.input.tooltip("close").attr("title", "");
					}, 2500);
					this.input.data("ui-autocomplete").term = "";
				},

				_destroy : function() {
					this.wrapper.remove();
					this.element.show();
				}
			});
		})(jQuery);
	</script>

	<script>
		(function($) {
			$(function() {
				$("#categoryId").name();
				$(".categorylist").name();
				$('.custom-name-input').on("click", function() {
					$old_value = $(this).val();
					$(this).val("");
				});
				$(".custom-name-input").on("blur", function() {
					if ($(this).val() == '') {
						$(this).val($old_value);
					}
				});
			});
		})(jQuery);
	</script>

	<div id="container">
		<div id="wrapper">
			<div id="content">
				<!-- <div class="mini-layout">
				<div><a href="?module_id={-$module_id-}&menu_switch=delzero" onclick="return confirm('是否确定执行此操作？')">自动设置所属分类</a>（根据外链分类规则）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
				</div> -->
				<div class="mini-layout">
					<table width="100%" border="0" cellpadding="0" cellspacing="0" class="tableborder">
						<tr class="header">
							<!-- <td colspan="4"><div style="float:left; margin-left:0px; padding-top:8px"></div><div style="float:right; margin-right:4px; padding-bottom:9px"></div></td> -->
						</tr>
						<tbody id="menu_userso" style="display:{-if in_array('userso',$menu_cookie)-}none{-/if-}">
							<form method="post" action="index.php?module=competence&action=User" name="form">
								<tr>
									<td width="16%" class="altbg1"><B>用户名：</B>
									</td>
									<td width="34%" class="altbg2">
										<input type="text" name="realname" value="{-$realname-}" autocomplete="off"/>
									</td>
									<td width="16%" class="altbg1"><B>所属权限组：</B></td>
									<td width="34%" class="altbg2"><span class="select_div">
										<select id="categoryId" name="categoryId" style="width:234px;color: #006699;">
											<option value="0">不筛选</option>
											{-section name=macompetence loop=$MAcompetence-}
											<option {-if $categoryId eq $MAcompetence[macompetence]-}selected{-/if-} value="{-$MAcompetence[macompetence]-}">{-$MAcompetence[macompetence]-}</option>
											{-/section-}
										</select> </span></td>
								</tr>

								<tr> 
									<td colspan="4">
									<div align="center">
										<input class="button" type="submit" name="submit" value="查 询" >
										&nbsp;
									</div></td>
								</tr>
							</form>
						</tbody>
					</table>
				</div>
				<div class="mini-layout">

					{-if $promotionurl_all-}
					<div class="pagination">
						{-$page-}
					</div>
					<div class="mini-layout">
						<form method="post" action="" name="form">
							<input type="hidden" name="menu_action" value="binding">
							<input type="hidden" name="PromotionName" value="{-$PromotionName-}" />
							<input type="hidden" name="url_jump" value="{-$reload-}&page={-$c_page-}" />
							<table width="100%" border="0" cellpadding="0" cellspacing="0" class="tableborder" style="table-layout: fixed">
								<tr align="center" class="header">
									<th width="380px" >名字</th>
									<th width="380px" >所属部门</th>
									<th width="280px" >所属权限组</th>
								</tr>
								<tr align="center" class="header">
									{-section name=promotionurl_all loop=$promotionurl_all-}
									<td class="altbg2" align="center" ><span title="{-$promotionurl_all[promotionurl_all].realname-}" class="PromotionName">{-$promotionurl_all[promotionurl_all].realname-}</span></td>
									<td class="altbg2" align="center">{-$promotionurl_all[promotionurl_all].name-}</td>
									<td>
									<div class="jt_bar" style="margin-top:5px;margin-left:35px;float:left;clear:left;">
										<select id="categoryId" name="userId[{-$promotionurl_all[promotionurl_all].uid-}]" style="width:234px;color: #006699;">
											{-section name=macompetence loop=$MAcompetence-}
											<option {-if $promotionurl_all[promotionurl_all].rule eq $MAcompetence[macompetence]-}selected{-/if-} value="{-$MAcompetence[macompetence]-}">{-$MAcompetence[macompetence]-}</option>
											{-/section-}
										</select>
									</div><td>
								</tr>
								{-/section-}
								<tr class="smalltxt">
									<td align="center" class="altbg1" >{-$zl.Click-}</td>
									<td align="center" class="altbg1" >{-$zl.member-}</td>
									<td align="center" class="altbg1" >{-$zl.mail-}</td>
									<td class="altbg2" align="center" ><a href="?module_id=73&up_promotion_id={-$categoryId-}{-if $so_array.endtime || $so_array.starttime-}&starttime={-$so_array.starttime-}&endtime={-$so_array.endtime-}{-/if-}{-if $PromotionName-}&PromotionName={-$PromotionName-}{-/if-}">{-$zl.Orders-}{-if $zl.Orders2!="" and $zl.Orders2!=0-} [{-$zl.Orders2-}]{-/if-}</a></td>
									{-if $so_array.endtime!="" or $so_array.starttime!=""-}
									<td align="center" class="altbg1">{-$zl.atm1-}</td>
									<td class="altbg2" align="center">{-$zl.atm2-}</td>
									{-/if-}
									<td align="center" class="altbg1">{-if $so_array.endtime!="" or $so_array.starttime!=""-}{-$zl.atm1+$zl.atm2-}{-/if-}</td>
								</tr>
							</table>

							{-/if-}
							<div style="margin:10px;" align="center">
								<input class="button" type="submit" name="submit" value="绑定权限组" onclick="javascript: return confirm('确定要绑定当前分类吗？'); ">
							</div>

						</form>
					</div>
					<div class="pagination">
						{-$page-}
					</div>
				</div>
			</div>
		</div>
		
		<script>
			(function($) {
				$('#jump').on('keyup', function() {
   				 var jump = this.value;
   				 var jumptag = $("#jumptag").attr("href");
   				 var url=jumptag.replace(/&page=\d{0,}/,'&page='+jump);
   				 $("#jumptag").attr("href", url);
				});
			})(jQuery);
		</script>
		
		<script>
			(function($) {
				jq(document).ready(function() {
					jq("#WebsiteId").change(function() {
						var websiteId = jq("#WebsiteId").val();
						var url = get_current_url();
						var module_id = '{-$module_id-}';
						var ajax_url = url + "?module_id=" + module_id + "&WebsiteId=" + websiteId + "&menu_action=add";
						window.location.href = ajax_url;
					});
				});

				function get_current_url() {
					var ajax_url = "http://" + window.location.hostname + window.location.pathname;
					return ajax_url;
				}

			})(jQuery);
		</script>

</body>