{-include file="header.htm"-}
{-include file="reference.htm"-}
<head>
<link href="scripts/jtable/themes/metro/darkgray/jtable.css"
	rel="stylesheet" type="text/css" />
<script src="scripts/jtable/jquery.jtable.js" type="text/javascript"></script>

<style>
.custom-name {
	position: relative;
	display: inline-block;
}

.custom-name-toggle {
	position: absolute;
	top: 0;
	bottom: 0;
	margin-left: -1px;
	padding: 0;
	/* support: IE7 */
	*height: 1.7em;
	*top: 0.1em;
}

.custom-name-input {
	margin: 0;
	padding: 0.3em;
	width: 300px;
}

.ui-autocomplete {
	max-height: 200px;
	overflow-y: auto;
}
</style>

<script>
	(function($) {
		$
				.widget(
						"custom.name",
						{
							_create : function() {
								this.wrapper = $("<span>").addClass(
										"custom-name")
										.insertAfter(this.element);

								this.element.hide();
								this._createAutocomplete();
								this._createShowAllButton();
							},

							_createAutocomplete : function() {
								var selected = this.element
										.children(":selected"), value = selected
										.val() ? selected.text() : "";

								this.input = $("<input>")
										.appendTo(this.wrapper)
										.val(value)
										.attr("title", "")
										.addClass(
												"custom-name-input ui-widget ui-widget-content ui-state-default ui-corner-left")
										.autocomplete({
											delay : 0,
											minLength : 0,
											source : $.proxy(this, "_source")
										}).tooltip({
											tooltipClass : "ui-state-highlight"
										});

								this._on(this.input, {
									autocompleteselect : function(event, ui) {
										ui.item.option.selected = true;
										this._trigger("select", event, {
											item : ui.item.option
										});
									},

									autocompletechange : "_removeIfInvalid"
								});
							},

							_createShowAllButton : function() {
								var input = this.input, wasOpen = false;

								$("<a>").attr("tabIndex", -1).attr("title",
										"显示全部选项").tooltip().appendTo(
										this.wrapper).button({
									icons : {
										primary : "ui-icon-triangle-1-s"
									},
									text : false
								}).removeClass("ui-corner-all").addClass(
										"custom-name-toggle ui-corner-right")
										.mousedown(
												function() {
													wasOpen = input
															.autocomplete(
																	"widget")
															.is(":visible");
												}).click(function() {
											input.focus();

											// Close if already visible
											if (wasOpen) {
												return;
											}

											// Pass empty string as value to search for, displaying all results
											input.autocomplete("search", "");
										});
							},

							_source : function(request, response) {
								var matcher = new RegExp($.ui.autocomplete
										.escapeRegex(request.term), "i");
								response(this.element
										.children("option")
										.map(
												function() {
													var text = $(this).text();
													if (this.value
															&& (!request.term || matcher
																	.test(text)))
														return {
															label : text,
															value : text,
															option : this
														};
												}));
							},

							_removeIfInvalid : function(event, ui) {

								// Selected an item, nothing to do
								if (ui.item) {
									return;
								}

								// Search for a match (case-insensitive)
								var value = this.input.val(), valueLowerCase = value
										.toLowerCase(), valid = false;
								this.element
										.children("option")
										.each(
												function() {
													if ($(this).text()
															.toLowerCase() === valueLowerCase) {
														this.selected = valid = true;
														return false;
													}
												});

								// Found a match, nothing to do
								if (valid) {
									return;
								}

								// Remove invalid value
								this.input.val("").attr("title",
										value + " 没有找到匹配的选项默认上次的结果").tooltip(
										"open");
								this.element.val("");
								this._delay(function() {
									this.input.tooltip("close").attr("title",
											"");
								}, 2500);
								this.input.data("ui-autocomplete").term = "";
							},

							_destroy : function() {
								this.wrapper.remove();
								this.element.show();
							}
						});
	})(jQuery);

	$(function() {
		$("#name").name();
		$('.custom-name-input').on("click", function() {
			$old_value = $(this).val();
			$(this).val("");
		});
		$(".custom-name-input").on("blur", function() {
			if ($(this).val() == '') {
				$(this).val($old_value);
			}
		});
	});
</script>
</head>
<body>
<input id="frame_url" type="hidden" value="{-$smarty.server.REQUEST_URI-}"/>
<div id="container">
	<div id="wrapper">
		<div id="content">
			<div id="rightnow">
				<h3>{-if $action_name=='edit'-}编辑分类{-else-}添加分类{-/if-}</h3>
				<form method="post" action="" name="form">
					<input type="hidden" name="menu_action"
						value="{-if $action_name=='edit'-}edit_categroypost{-else-}add_categroypost{-/if-}">
					<input type="hidden" name="id" value="{-$edit_array.Id-}">
					<table width="100%" border="0" cellpadding="0" cellspacing="0"
						class="tableborder">
						<tr>
							<td width="33%" class="altbg1"><B>{-$WebsiteUrl-}</B></td>
							<td colspan="4" class="altbg2"><input type="hidden"
								value="{-$WebsiteId-}" name="WebsiteId" /></td>
						</tr>

						<tr>
							<td width="33%" class="altbg1"><B>分类名称:</B><BR>
							<SPAN class=smalltxt>分类的名称</SPAN></td>
							<td colspan="4" class="altbg2"><input type="text"
								name="name" value="{-$edit_array.name-}" size="20"
								onFocus="brightBox(this);" onBlur="dimBox(this);"></td>
						</tr>
						<tr>
							<td class="altbg1" width="33%"><B>上级分类:</B><BR> <SPAN
								class=smalltxt>本栏目的上分类<br></SPAN></td>
							<td colspan="4" class="altbg2"><div class="select_div">
									<select id="name" name="fup"
										style="width: 334px; color: #006699;">
										<option value="0"></option> {-$class_all_option-}
									</select>
								</div></td>
						</tr>
						<tr>
					</table>
					<br />
					<center>
						<input class="button" type="submit" name="submit" value="提 交">
					</center>
				</form>
				<br />
				</td>
				</tr>
				</table>
			</div>
		</div>
	</div>
</div>
</body>